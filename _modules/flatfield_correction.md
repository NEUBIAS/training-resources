---
title: Flat-field correction
layout: module
tags: 
prerequisites:
  - "[Illumination and shading artefacts](../illumination_artefact)"
  - "[Convolutional filters](../filter_convolution)"
  - "[Object intensity measurements](../measure_intensities)"
objectives:
  - Formulate the mathematical relationship between the raw image and the corrected image
  - Evaluate methods to obtain a flat-field reference (calibration slide or retroscpective computation)
  - Perform a flat-field correction and evaluate the results
motivation: |
  In quantitative fluorescence microscopy, we assume that the pixel intensity is proportional to the concentration of the fluorophore. However, uneven illumination (vignetting) and optical obstructions (dust) violate this assumption. Without correction we may have (1) *Intensity bias*, where cells may appear brighter in the middle than on the edge, (2) *Segmentation errors* segmentation algorithms may fail in certain part of an image. Therefore it is important to learn methods on how to mitigate illumination artefatcs. 

concept_map: > 
  graph TD
      S("Sample img. (S)")
      B("Dark frame (D)")
      
      
      Slide["Standard slide/dye"] --- F("Bright img. (F)")
      Retrospective["Restrospective Mean/Median"] --- F
      S --- Subtraction(("Subtract D"))
      B --- Subtraction
      F --- Subtraction
      subgraph math[" "]
      Subtraction --- S_bg("S background corr. (Sb)")
      Subtraction --- F_bg("F background corr. (Fb)")
      F_bg --- Normalization(("Normalize</br>Fb/mean(Fb)"))
      Normalization --- F_bg_norm("Flat field reference (Ff)")
      F_bg_norm --- Division
      S_bg --- Division(("Divide </br> Sb/Ff"))
      %% Bottom label simulation
      L["Math Operations"]
      style L fill:none,stroke:none,font-weight:bold
      end
      Division --- Corrected("Flat field corrected sample image")


figure: /figures/flatfield_correction.png
figure_legend: Left side - To compute a flat field reference we can use a measurement from a standard (homgeneous) slide or retrospectively use acquired images. Right side - Given a flat-field reference we can perform the correction of the illumination aberration 

multiactivities:
  - ["flatfield_correction/act01.md", [["ImageJ Macro", "flatfield_correction/act01_imagejmacro.ijm"]]]
  - ["flatfield_correction/act02.md", [["ImageJ Macro", "flatfield_correction/act02_imagejmacro.ijm"]]]
  - ["flatfield_correction/act03.md", [["ImageJ Macro", "flatfield_correction/act03_imagejmacro.ijm"]]]
assessment: >
  ### Which of the following issues can be corrected using a standard Flat-field correction (FFC)?
  
    1. Random Poisson noise (shot noise)
    2. Uneven illumination and dust on the lens 
    3. Over-saturated pixels
    4. Specimen movement during acquisition
    
    > ## Solution
    > Issue number 2
    {: .solution}

  ### What is the primary purpose of a "Dark Frame" (or Background Reference) in the FFC workflow?

    1. To measure the maximum brightness of the lamp.
    2. To identify the focal plane.
    3. To subtract the electronic signal generated by the sensor in the absence of light (Dark Current/Offset).
    4. To normalize the image to 1.0.

    > ## Solution
    > Answer number  3 
    {: .solution}

  ### You change your microscope objective from 10x to 40x. Can you use the same flat-field reference image?

    1. Yes, the illumination pattern is independent of the objective.
    2. No, the optical path and shading patterns are specific to each objective/filter combination.

    > ## Solution
    > Answer number  2 
    {: .solution}

learn_next:
  - 

external_links:
  - "[How to acquire flat-field corrected images](https://calm.ucsf.edu/how-acquire-flat-field-correction-images)"
---

